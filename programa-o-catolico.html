<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>O Católico – Valmi TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header>
    <div class="container navbar">
      <div class="brand">
        <div class="brand-logo"></div>
        <div class="brand-title">VALMI TV</div>
      </div>
      <div class="nav-toggle" onclick="toggleMenu()">
        <span></span><span></span><span></span>
      </div>
      <nav class="nav-menu" id="navMenu">
        <ul>
          <li><a href="index.html">Início</a></li>
          <li><a href="programas.html">Programas</a></li>
          <li><a href="ao-vivo.html">Ao vivo</a></li>
          <li><a href="podcast.html">Podcast</a></li>
          <li><a href="sobre.html">Sobre</a></li>
          <li><a href="contato.html">Contato</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="page-header">
      <h1 class="page-title">O Católico</h1>
      <p class="page-description">
        Um programa voltado à vida do católico no dia a dia, costumes, devoções
        e orientações práticas à luz da doutrina da Igreja.
      </p>
    </section>

    <section class="section program-layout">
      <div>
        <!-- VÍDEO PRINCIPAL -->
        <div class="program-hero">
          <h2 class="section-title">Último episódio</h2>

          <div class="card-thumb" id="mainVideo" style="margin-bottom:1rem; overflow:hidden;">
            <!-- Iframe do vídeo em foco será inserido aqui via JS -->
          </div>

          <div class="program-meta">
            Reprodução automática a partir da playlist oficial de O Católico.
          </div>

          <div class="hero-actions" style="margin-top:1rem;">
            <a href="https://www.youtube.com/playlist?list=PLrOEqj4ng7UI1qjgag8v44aricWSD2RRW"
               target="_blank" class="btn btn-primary">
              Ver playlist completa no YouTube
            </a>
          </div>
        </div>

        <!-- EPISÓDIOS RECENTES -->
        <div class="program-episodes">
          <h2 class="section-title">Episódios recentes</h2>
          <div id="recentEpisodes"></div>
        </div>
      </div>

      <aside class="sidebar-card">
        <h3 class="card-title">Outros programas Valderi</h3>
        <ul style="list-style:none; margin-top:0.5rem; font-size:0.9rem;">
          <li><a href="programa-critica-catolica.html" style="color:#f5f5f5; text-decoration:none;">Crítica Católica</a></li>
          <li><a href="programa-filos.html" style="color:#f5f5f5; text-decoration:none;">.filos</a></li>
          <li><a href="programas-valderi.html" style="color:#f5f5f5; text-decoration:none;">Ver todos</a></li>
        </ul>
      </aside>
    </section>
  </main>

  <footer>
    <div class="container">
      <div>© <span id="year"></span> Valmi TV.</div>
    </div>
  </footer>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('navMenu');
      menu.classList.toggle('open');
    }
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===============================
    //   CONFIGURAÇÕES
    // ===============================
    const API_KEY = "AIzaSyAmNoCTSSD4t7YJCzo_Ak_BYXDmvFrM0cE";
    const PLAYLIST_ID = "PLrOEqj4ng7UI1qjgag8v44aricWSD2RRW"; // TROCAR!
    const MAX_RESULTS = 3;

    const mainVideoDiv = document.getElementById("mainVideo");
    const recentContainer = document.getElementById("recentEpisodes");

    function setPlayer(videoId) {
      mainVideoDiv.innerHTML = `
        <iframe
          style="width:100%; aspect-ratio:16/9; border:0;"
          src="https://www.youtube.com/embed/${videoId}"
          title="O Católico - episódio"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      `;
    }

    async function loadPlaylist() {
      const url =
        `https://www.googleapis.com/youtube/v3/playlistItems` +
        `?part=snippet&maxResults=${MAX_RESULTS}` +
        `&playlistId=${PLAYLIST_ID}&key=${API_KEY}`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (!data.items || !data.items.length) return;

        const firstSnippet = data.items[0].snippet;
        const firstId = firstSnippet.resourceId.videoId;
        setPlayer(firstId);

        recentContainer.innerHTML = data.items
          .map(item => {
            const s = item.snippet;
            const vid = s.resourceId.videoId;
            const published = new Date(s.publishedAt).toLocaleDateString("pt-BR");
            const description = (s.description || "").substring(0, 140);

            return `
              <article class="episode-item" data-video-id="${vid}">
                <div class="episode-thumb" style="
                  background:url('https://i.ytimg.com/vi/${vid}/hqdefault.jpg') center center / cover no-repeat;
                "></div>

                <div>
                  <h3 class="card-title">${s.title}</h3>
                  <div class="card-meta">${published}</div>

                  <p style="font-size:0.9rem; margin-top:0.25rem;">
                    ${description}...
                  </p>

                  <button class="btn btn-secondary js-watch"
                          data-video-id="${vid}"
                          style="margin-top:0.4rem;">
                    Assistir
                  </button>
                </div>
              </article>
            `;
          })
          .join("");

      } catch (error) {
        console.error("Erro ao carregar playlist (O Católico):", error);
      }
    }

    recentContainer.addEventListener("click", (event) => {
      const button = event.target.closest(".js-watch");
      const card = event.target.closest("[data-video-id]");

      if (!button && !card) return;
      event.preventDefault();

      const videoId =
        (button && button.getAttribute("data-video-id")) ||
        (card && card.getAttribute("data-video-id"));

      if (!videoId) return;
      setPlayer(videoId);
      mainVideoDiv.scrollIntoView({ behavior: "smooth", block: "start" });
    });

    loadPlaylist();
  </script>
</body>
</html>
