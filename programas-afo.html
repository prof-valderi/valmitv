<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Programas AFO – Valmi TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container navbar">
      <div class="brand">
        <a href="index.html" class="brand-link">
          <div class="brand-logo"></div>
          <div class="brand-title">VALMI TV</div>
        </a>
      </div>
      <div class="nav-toggle" onclick="toggleMenu()">
        <span></span><span></span><span></span>
      </div>
      <nav class="nav-menu" id="navMenu">
        <ul>
          <li><a href="index.html" class="nav-link">Início</a></li>
          <li><a href="programas.html" class="nav-link">Programas</a></li>
          <li><a href="ao-vivo.html" class="nav-link">Ao vivo</a></li>
          <li><a href="observatorio.html" class="nav-link">Observatório</a></li>
          <li><a href="sobre.html" class="nav-link">Sobre</a></li>
          <li><a href="contato.html" class="nav-link">Contato</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- CABEÇALHO -->
    <section class="page-header">
      <h1 class="page-title">Programas AFO</h1>
      <p class="page-description">
        Conteúdos do Apostolado em Família de Oração: novenas, missas, meditações,
        terços, adorações e momentos especiais de oração em comunidade.
      </p>
    </section>

    <!-- PLAYER AFO NO TOPO -->
    <section class="section">
      <div class="program-hero">
        <h2 class="section-title">Player AFO</h2>
        <p class="program-meta">
          A playlist mais recente aparece automaticamente no player abaixo.
          Você pode trocar de playlist clicando em <strong>Assistir aqui</strong> nos cards.
        </p>

        <div class="card-thumb" id="afoPlayerWrapper" style="overflow:hidden;">
          <!-- O player da playlist selecionada aparece aqui -->
        </div>

        <p class="program-meta" style="margin-top:0.75rem;">
          Use a lista do próprio player para navegar entre os vídeos da playlist escolhida.
        </p>
      </div>
    </section>

    <!-- GRID DE PLAYLISTS AFO -->
    <section class="section">
      <h2 class="section-title">Séries e playlists</h2>
      <p class="section-subtitle">
        Cada card abaixo representa uma playlist da AFO. Clique em <strong>Assistir aqui</strong>
        para carregar a playlist no player acima.
      </p>

      <div class="grid-cards" style="margin-top:1rem;">

        <!-- 1 – Novena e momentos de oração -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7UKok8ZLblS85GvvsDxgCG7a"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Novena e momentos de oração AFO</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 2 – Terços e devoções marianas -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7ULteui-qK2CW4QPT_8yYVCv"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Terços e devoções marianas</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 3 – Missas e celebrações AFO -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7UKriowY85n-Bz5AOuIgA-54"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Missas e celebrações AFO</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 4 – Adoração ao Santíssimo -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7ULl-ah35NQdfrYaucdW0U7u"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Adoração ao Santíssimo</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 5 – Formação e pregações -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7UIsXVpcf-s0kk4MmmIE-Iyu"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Formação e pregações AFO</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 6 – Novenas especiais -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7UI6YRhZWWtOXJDPIXDXH3i_"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Novenas especiais</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 7 – Encontros de oração AFO -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7UI848w7gkQK2eqFTPqU7g_q"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Encontros de oração AFO</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 8 – Retiros e especiais -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7UJ-h4ZQ02GfAfpO6zHKcFSg"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Retiros e especiais AFO</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

        <!-- 9 – Catequese e ensino -->
        <div
          class="card afo-card"
          data-playlist-id="PLrOEqj4ng7UIKPj0PTqjlwgHz3v-bnuBP"
        >
          <div class="card-thumb program-thumb"></div>
          <div class="card-title">Catequese e ensino AFO</div>
          <div class="card-meta">Carregando informações…</div>
          <div class="hero-actions" style="margin-top:0.5rem;">
            <a class="btn btn-secondary afo-link" href="#">Assistir aqui</a>
          </div>
        </div>

      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div>© <span id="year"></span> Valmi TV.</div>
    </div>
  </footer>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('navMenu');
      menu.classList.toggle('open');
    }
    document.getElementById('year').textContent = new Date().getFullYear();

    // ==============================
    //   PLAYER AFO + MINIATURAS + DESTAQUE MAIS RECENTE
    // ==============================
    const API_KEY = "AIzaSyAmNoCTSSD4t7YJCzo_Ak_BYXDmvFrM0cE";

    const playerWrapper = document.getElementById("afoPlayerWrapper");

    // Guardamos também o elemento raiz do card para poder destacar
    const afoCards = Array.from(document.querySelectorAll(".afo-card")).map(cardEl => ({
      rootEl: cardEl,
      playlistId: cardEl.dataset.playlistId,
      thumbEl: cardEl.querySelector(".program-thumb"),
      metaEl: cardEl.querySelector(".card-meta"),
      linkBtn: cardEl.querySelector(".afo-link")
    }));

    function setAfoPlayer(playlistId) {
      if (!playlistId) return;
      playerWrapper.innerHTML = `
        <iframe
          style="width:100%; aspect-ratio:16/9; border:0;"
          src="https://www.youtube.com/embed/videoseries?list=${playlistId}"
          title="Playlist AFO"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      `;
    }

    async function getLatestFromPlaylist(playlistId) {
      const url =
        "https://www.googleapis.com/youtube/v3/playlistItems" +
        `?part=snippet&maxResults=1&playlistId=${playlistId}&key=${API_KEY}`;

      const res = await fetch(url);
      const data = await res.json();

      if (!data.items || !data.items.length) return null;

      const snippet = data.items[0].snippet;
      const thumbs = snippet.thumbnails || {};
      const thumbUrl =
        (thumbs.maxres && thumbs.maxres.url) ||
        (thumbs.high && thumbs.high.url) ||
        (thumbs.medium && thumbs.medium.url) ||
        (thumbs.default && thumbs.default.url) ||
        "";

      return {
        videoId: snippet.resourceId.videoId,
        title: snippet.title,
        publishedAt: snippet.publishedAt,
        thumbUrl
      };
    }

    async function loadAfoPlaylists() {
      let latest = null; // vamos guardar a playlist com vídeo mais recente

      for (const card of afoCards) {
        try {
          const info = await getLatestFromPlaylist(card.playlistId);

          if (!info) {
            card.metaEl.textContent = "Não foi possível carregar o último vídeo.";
            continue;
          }

          // thumbnail
          if (card.thumbEl && info.thumbUrl) {
            card.thumbEl.style.backgroundImage = `url('${info.thumbUrl}')`;
            card.thumbEl.style.backgroundSize = "cover";
            card.thumbEl.style.backgroundPosition = "center";
          }

          // texto meta
          const dataBR = new Date(info.publishedAt).toLocaleDateString("pt-BR");
          card.metaEl.textContent = `Último vídeo: ${info.title} · ${dataBR}`;

          // botão "Assistir aqui" carrega a playlist no player
          card.linkBtn.addEventListener("click", (e) => {
            e.preventDefault();
            setAfoPlayer(card.playlistId);
            playerWrapper.scrollIntoView({ behavior: "smooth", block: "start" });
          });

          // verificar se esta playlist tem o vídeo mais recente até agora
          if (!latest || new Date(info.publishedAt) > new Date(latest.info.publishedAt)) {
            latest = { card, info };
          }

        } catch (err) {
          console.error("Erro ao carregar playlist AFO:", err);
          card.metaEl.textContent = "Erro ao carregar informações desta playlist.";
        }
      }

      // Depois de processar todas, destacamos a mais recente e definimos o player
      if (latest) {
        // Playlist mais recente no player AFO logo ao abrir a página
        setAfoPlayer(latest.card.playlistId);

        // Destacar o card visualmente
        latest.card.rootEl.classList.add("afo-card-featured");
      }
    }

    loadAfoPlaylists();
  </script>
</body>
</html>
